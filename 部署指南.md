# 🚀 飞书应用配置与部署指南

## 第一步：部署项目到服务器

### 方式1：使用免费静态托管服务

#### GitHub Pages (推荐)
1. 在GitHub创建新仓库
2. 上传所有项目文件
3. 在仓库设置中启用GitHub Pages
4. 获得类似 `https://你的用户名.github.io/仓库名` 的地址

#### Vercel
1. 访问 [vercel.com](https://vercel.com)
2. 连接GitHub仓库或直接上传文件
3. 自动部署，获得HTTPS地址

#### Netlify
1. 访问 [netlify.com](https://netlify.com)
2. 拖拽项目文件夹到部署区域
3. 自动生成HTTPS地址

### 方式2：使用自己的服务器
确保服务器支持HTTPS（飞书强制要求），将文件上传到Web根目录。

## 第二步：在飞书开放平台配置应用

### 1. 登录飞书开放平台
访问：https://open.feishu.cn/

### 2. 进入应用管理
- 点击"控制台"
- 选择你的应用（App ID: cli_a8ed266753be901c）

### 3. 配置安全域名
在"安全设置" → "安全域名"中添加：
```
你的域名（例如：yourname.github.io）
```

### 4. 配置重定向URL
在"安全设置" → "重定向URL"中添加：
```
https://你的域名/index.html
https://你的域名/demo.html
```

### 5. 申请权限
在"权限管理"中申请以下权限：
- ✅ 获取用户基本信息
- ✅ 获取用户身份（如果需要）

## 第三步：创建飞书工作台应用

### 1. 进入飞书管理后台
登录你的飞书企业管理后台

### 2. 创建工作台应用
- 进入"工作台" → "应用管理"
- 点击"添加应用" → "添加自建应用"

### 3. 配置应用信息
```
应用名称：飞书免登陆Demo
应用描述：展示用户信息的演示应用
应用图标：上传一个图标
首页地址：https://你的域名/index.html
```

### 4. 关联开放平台应用
- 在应用设置中找到"开放平台配置"
- 输入你的 App ID: cli_a8ed266753be901c
- 保存配置

### 5. 发布应用
- 点击"发布版本"
- 选择发布范围（全员或指定部门）
- 提交审核（部分企业需要）

## 第四步：测试应用

### 1. 在飞书客户端测试
- 打开飞书客户端
- 进入"工作台"
- 找到你创建的应用
- 点击打开

### 2. 预期效果
- 应用自动加载
- 显示加载动画
- 获取并展示用户信息（姓名、邮箱、部门等）

## 第五步：调试问题

### 常见问题及解决方案

#### 问题1：显示"当前不在飞书应用环境中"
**原因**：在普通浏览器中打开了应用
**解决**：必须在飞书客户端中打开

#### 问题2：免登陆失败
**原因**：配置问题
**检查**：
- App ID 是否正确配置
- 安全域名是否已添加
- 重定向URL是否正确

#### 问题3：获取用户信息失败
**原因**：权限不足
**解决**：
- 检查应用权限设置
- 确认用户已同意授权

#### 问题4：页面加载失败
**原因**：HTTPS或文件路径问题
**检查**：
- 确保使用HTTPS协议
- 检查所有文件是否正确上传
- 确认文件路径正确

## 第六步：生产环境优化

### 安全建议
由于你的 App Secret 已经在前端代码中，建议：

1. **仅用于测试环境**
2. **生产环境应创建后端API**

### 后端API示例（推荐）
```javascript
// server.js (Node.js + Express)
const express = require('express');
const fetch = require('node-fetch');
const app = express();

app.use(express.json());
app.use(express.static('public')); // 放置你的HTML文件

// 飞书免登陆API
app.post('/api/feishu/auth', async (req, res) => {
    const { code } = req.body;
    
    try {
        // 使用code换取access_token
        const tokenResponse = await fetch('https://open.feishu.cn/open-apis/authen/v1/access_token', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                grant_type: 'authorization_code',
                code: code,
                app_id: 'cli_a8ed266753be901c',
                app_secret: 'UsUeDrTo6eG80WRxYgFSbfvEGQ4LfLFc'  // 服务器端安全存储
            })
        });
        
        const tokenData = await tokenResponse.json();
        
        if (tokenData.code !== 0) {
            return res.status(400).json({ error: '获取token失败', details: tokenData });
        }
        
        // 获取用户信息
        const userResponse = await fetch('https://open.feishu.cn/open-apis/authen/v1/user_info', {
            headers: { 'Authorization': `Bearer ${tokenData.access_token}` }
        });
        
        const userData = await userResponse.json();
        
        if (userData.code !== 0) {
            return res.status(400).json({ error: '获取用户信息失败', details: userData });
        }
        
        res.json(userData.data);
        
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

app.listen(3000, () => {
    console.log('服务器运行在 http://localhost:3000');
});
```

### 修改前端代码调用后端API
```javascript
// 在 script.js 中修改 fetchUserInfoWithCode 方法
async fetchUserInfoWithCode(code) {
    const response = await fetch('/api/feishu/auth', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ code })
    });
    
    if (!response.ok) {
        throw new Error(`API调用失败: ${response.status}`);
    }
    
    return await response.json();
}
```

## 📝 配置检查清单

在飞书应用正式发布前，请确认：

- [ ] 项目已部署到HTTPS服务器
- [ ] 飞书开放平台已配置安全域名
- [ ] 重定向URL配置正确
- [ ] 应用权限已申请并通过
- [ ] 工作台应用已创建并关联
- [ ] 应用已发布给目标用户
- [ ] 在飞书客户端中测试正常

## 🆘 需要帮助？

如果遇到问题，可以：
1. 查看浏览器控制台的错误信息
2. 检查网络请求是否成功
3. 参考飞书开放平台的官方文档
4. 在演示页面（demo.html）中测试功能

---

🎯 **完成以上步骤后，你的飞书应用就可以正常访问和使用了！** 